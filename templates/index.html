<!DOCTYPE html>
<html>
<head>
    <title>Sentiment Analysis Chat App</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: #e5ddd5;
            margin: 0;
            padding: 0;
        }

        header {
            background: linear-gradient(90deg, #075e54, #128c7e);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 10px;
        }

        form {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 15px;
        }

        input[type="file"] {
            margin-top: 8px;
        }

        button {
            background: #128c7e;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            margin-top: 10px;
        }

        button:hover {
            background: #075e54;
        }

        /* ---------- Chat Window ---------- */
        .chat-window {
            background: #efeae2;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        .chat-bubble {
            max-width: 70%;
            padding: 10px 14px;
            margin-bottom: 10px;
            border-radius: 10px;
            position: relative;
            font-size: 15px;
            line-height: 1.4;
        }

        .left {
            background: white;
            align-self: flex-start;
            border-top-left-radius: 0;
        }

        .right {
            background: #dcf8c6;
            align-self: flex-end;
            margin-left: auto;
            border-top-right-radius: 0;
        }

        .sender {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 3px;
            color: #555;
        }

        .sentiment {
            font-size: 13px;
            margin-top: 5px;
        }

        .positive { color: green; }
        .neutral { color: orange; }
        .negative { color: red; }

        .confidence {
            font-size: 12px;
            color: #666;
        }

        .result-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .chart img {
            width: 100%;
            max-width: 450px;
            display: block;
            margin: auto;
        }

        a {
            color: #128c7e;
            font-weight: bold;
            text-decoration: none;
        }
    </style>
</head>

<body>

<header>
    <h1>Sentiment Analysis Chat App</h1>
    <p>Chat-based sentiment analysis with confidence & visualization</p>
</header>

<div class="container">

    <!-- CSV Upload -->
    <form method="POST" enctype="multipart/form-data">
        <h3>Upload Chat CSV</h3>
        <p>Format: sender,message</p>
        <input type="file" name="chatfile" accept=".csv">
        <br>
        <button type="submit">Analyze Chat</button>
    </form>

    <!-- Single Message -->
    <form method="POST">
        <h3>Analyze Single Message</h3>
        <textarea name="text" placeholder="Type your message here..."></textarea>
        <br>
        <button type="submit">Analyze</button>
    </form>

    <!-- Single Message Result -->
    {% if sentiment %}
    <div class="result-box">
        <h3>Message Sentiment</h3>
        <p class="
            {% if sentiment_class == 'Positive' %}positive
            {% elif sentiment_class == 'Neutral' %}neutral
            {% else %}negative{% endif %}
        ">
            {{ sentiment }}
        </p>
    </div>
    {% endif %}

    <!-- Chat Results -->
    {% if df_results is not none and not df_results.empty %}
    <div class="result-box">
        <h3>Chat Analysis</h3>

        <div class="chat-window" id="chatWindow">
            {% for row in df_results.itertuples() %}
                <div class="chat-bubble {% if loop.index % 2 == 0 %}right{% else %}left{% endif %}">
                    <div class="sender">{{ row.sender }}</div>
                    {{ row.message }}
                    <div class="sentiment
                        {% if row.sentiment == 'Positive' %}positive
                        {% elif row.sentiment == 'Neutral' %}neutral
                        {% else %}negative{% endif %}
                    ">
                        {{ row.sentiment }} {{ row.emoji }}
                        <span class="confidence">({{ row.confidence }}%)</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Chart -->
    <div class="result-box chart">
        <h3>Sentiment Distribution</h3>
        <img src="{{ url_for('static', filename='sentiment_chart.png') }}">
        <p>â¬‡ Download CSV:
            <a href="{{ url_for('static', filename='chat_sentiment_results.csv') }}">
                chat_sentiment_results.csv
            </a>
        </p>
    </div>
    {% endif %}

</div>

<!-- Auto Scroll -->
<script>
    window.onload = function() {
        let chat = document.getElementById("chatWindow");
        if (chat) {
            chat.scrollTop = chat.scrollHeight;
        }
    }
</script>

</body>
</html>
